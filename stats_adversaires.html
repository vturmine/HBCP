
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Stats Équipes Adverses - Seniors</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">
  <style>
    body, table, th, td {
      font-size: 0.85rem;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
</head>
<body class="p-4">
  <div class="container">
    <h2 class="mb-4">Statistiques par Équipe</h2>
    <div id="equipe-buttons" class="mb-3 btn-group flex-wrap"></div>

    <div class="mb-3">
      <button class="btn btn-secondary me-2" onclick="setFilter('all')">Tous les matchs</button>
      <button class="btn btn-secondary me-2" onclick="setFilter('domicile')">Domicile</button>
      <button class="btn btn-secondary" onclick="setFilter('extérieur')">Extérieur</button>
    </div>

    <div class="table-responsive" style="max-height: 600px; overflow-y: auto;">
      <table class="table table-striped table-bordered" id="stats-table" style="width:100%">
        <thead><tr id="table-head"></tr></thead>
        <tbody id="table-body"></tbody>
      </table>
    </div>
  </div>

  <script>
    const equipes = [
      "CM_AUBERVILLIERS",
      "ES_COLOMBIENNE",
      "HBC_CONFLANS",
      "HBC_VAL-DE-SEINE",
      "JOINVILLE_HBA",
      "RUEIL_AC_1B",
      "TU_VERRIERES",
      "USC_MAISONS-LAFFITTE_HB",
      "USM_VILLEPARISIS",
      "VERSAILLES_HBC",
      "VILLEMOMBLE_HB_1B",
      "CSM_FINANCES"
    ];
    let currentEquipe = equipes[0];
    let allRows = [];
    let currentFilter = 'all';
    let dataTable;

    function setFilter(filter) {
      currentFilter = filter;
      renderTable();
    }

    function loadEquipe(equipe) {
      currentEquipe = equipe;
      fetch(`stats_equipe/${equipe}.csv`)
        .then(response => response.text())
        .then(csv => {
          const parsed = Papa.parse(csv, { header: true });
          allRows = parsed.data;
          renderTable();
        });
    }

    function renderTable() {
      if (dataTable) {
        dataTable.destroy();
        document.getElementById("table-body").innerHTML = "";
        document.getElementById("table-head").innerHTML = "";
      }

      if (allRows.length === 0) return;

      const columns = Object.keys(allRows[0]);

      // En-tête
      columns.forEach(col => {
        const th = document.createElement("th");
        th.textContent = col;
        document.getElementById("table-head").appendChild(th);
      });

      // Lignes filtrées
      const filteredRows = allRows.filter(row => {
        if (currentFilter === 'all') return true;
        return row['Type_Match'] === currentFilter;
      });

      // Corps
      filteredRows.forEach(row => {
        const tr = document.createElement("tr");
        columns.forEach(col => {
          const td = document.createElement("td");
          td.textContent = row[col];
          tr.appendChild(td);
        });
        document.getElementById("table-body").appendChild(tr);
      });

      dataTable = new DataTable('#stats-table', {
        paging: false,
        info: false,
        language: {
          search: "Rechercher :",
          zeroRecords: "Aucun résultat trouvé",
          emptyTable: "Aucune donnée disponible",
        }
      });
    }

    // Boutons équipes
    const btnGroup = document.getElementById("equipe-buttons");
    equipes.forEach(equipe => {
      const btn = document.createElement("button");
      btn.className = "btn btn-primary me-2 mb-2";
      btn.textContent = equipe.replaceAll("_", " ");
      btn.onclick = () => loadEquipe(equipe);
      btnGroup.appendChild(btn);
    });

    // Chargement initial
    loadEquipe(currentEquipe);
  </script>
</body>
</html>
